import{_ as d,o as l,c as h,a as i,t as u,e as g,F as c,f as p,d as f}from"./index-d0796c82.js";const m={watch:{"$route.query"(e){this.$refs.select.value=e.id,this.findClosestFlight(e.id)}},data(){return{show_myDestination:!1,flightData:null,resStatusMsg:"",flightBoxMsg:"",destIdList:[],closestFlightMsg:""}},methods:{sendXhrRequest(){return this.$store.state.flightCache?Promise.resolve(this.$store.state.flightCache):new Promise((e,s)=>{const t=new XMLHttpRequest;t.open("GET","https://tdx.transportdata.tw/api/basic/v2/Air/FIDS/Airport/Departure"),t.send(),t.addEventListener("load",function(){t.status>=200&&t.status<400?e(JSON.parse(t.responseText)):s(`錯誤狀態${t.status}，錯誤信息${t.statusText}`)})})},sendFlightRequest(){this.show_myDestination=!1,this.sendXhrRequest().then(e=>{this.flightData=e,this.$store.commit("saveFlightCache",e),this.resStatusMsg="啊哈哈<(*￣▽￣*)/",this.flightBoxMsg=this.getResMsg(e),this.destIdList=this.getDestIdList(e),this.show_myDestination=!0}).catch(e=>{this.resStatusMsg="失敗了的說 0_0",this.flightBoxMsg=e})},getResMsg(e){return e.reduce((s,t)=>s+`航班${t.AirlineID}${t.FlightNumber}到${t.ArrivalAirportID}，起飛時間是${this.formatDate(t.ScheduleDepartureTime)}<br/>`,"")},getDestIdList(e){const s=[];return e.forEach(t=>{s.includes(t.ArrivalAirportID)||s.push(t.ArrivalAirportID)}),s.sort()},formatDate(e){const s=new Date(e),t=s.getHours().toString().padStart(2,"0"),n=s.getMinutes().toString().padStart(2,"0");return`${t}:${n}`},addQueryToRoute(e){this.$router.push({name:this.$route.name,query:{id:e.target.value}})},findClosestFlight(e){const s=this.flightData.filter(t=>t.ArrivalAirportID===e&&new Date(t.ScheduleDepartureTime).getTime()>new Date().getTime()+36e5);if(s.length===0)this.closestFlightMsg=`很遺憾，台灣已經沒有1小時後起飛去往${e}的航班了，去重新安排旅程吧`;else{const t=s.sort((n,r)=>new Date(n.ScheduleDepartureTime)-new Date(r.ScheduleDepartureTime))[0];this.closestFlightMsg=`很幸運，台灣還有${s.length}架航班會在1小時後起飛去往${e}，最快的航班是${t.AirlineID}${t.FlightNumber}，起飛時間是${this.formatDate(t.ScheduleDepartureTime)}`}}}},D={style:{padding:"30px"}},_={style:{"margin-bottom":"16px"}},v=i("div",null,"航班資料:",-1),x=["innerHTML"],M={style:{display:"flex","justify-content":"space-between",width:"300px"}},w={key:0},y=i("option",{value:"",disabled:"",selected:""},"請選擇",-1),S=["value"],T=i("div",null,"最快航班：",-1);function $(e,s,t,n,r,a){return l(),h("section",D,[i("div",_,[v,i("div",{innerHTML:r.flightBoxMsg,style:{width:"330px",height:"300px",border:"1px solid black",padding:"10px","margin-bottom":"10px",overflow:"auto"}},null,8,x),i("div",M,[i("span",null,u(r.resStatusMsg),1),i("button",{onClick:s[0]||(s[0]=(...o)=>a.sendFlightRequest&&a.sendFlightRequest(...o))},"取得")])]),r.show_myDestination?(l(),h("div",w,[g(" 我的目的地: "),i("select",{onChange:s[1]||(s[1]=(...o)=>a.addQueryToRoute&&a.addQueryToRoute(...o)),ref:"select"},[y,(l(!0),h(c,null,p(r.destIdList,o=>(l(),h("option",{value:o},u(o),9,S))),256))],544),T,i("div",null,u(r.closestFlightMsg),1)])):f("",!0)])}const b=d(m,[["render",$]]);export{b as default};
